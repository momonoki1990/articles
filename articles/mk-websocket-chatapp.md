---
title: "WebSocket API x Serverless Framework x Node.js/Go„Åß„ÉÅ„É£„ÉÉ„Éà„Ç¢„Éó„É™„Çí„Å§„Åè„Å£„Å¶„Åø„Åü"
emoji: "üë®"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: ["apigateway", "websocket", "serverlessframework", "nodejs", "go"]
published: true
published_at: 2022-11-21 07:00
---

„ÇÇ„ÅÜ„Åô„Åê 2 Ê≠≥„Å´„Å™„ÇãÊ¨°Áî∑„Åå„Çà„ÅèÂØù„Å¶„Åè„Çå„Çã„Çà„ÅÜ„Å´„Å™„Å£„Åü„Åõ„ÅÑ„Åã„ÄÅ2 Âπ¥„Å∂„Çä„Åè„Çâ„ÅÑ„Å´Êó©Ëµ∑„Åç„ÅåÁøíÊÖ£Âåñ„Åó„Å¶„Åç„Åæ„Åó„Åü w
„Ç®„É≥„Ç∏„Éã„Ç¢„ÅÆÁÜäÁÄ¨Â∑ù„Åß„Åô„ÄÇ

AWS „ÅÆ„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´„Åß‰ΩúÊàê„Åó„Åü API Gateway „ÅÆ WebSocket API „Çí‰Ωø„Å£„Åü„ÉÅ„É£„ÉÉ„Éà„Ç¢„Éó„É™„Çí„ÄÅServerless Framework „ÅßÂÜçÁèæ„Åó„Å¶„Åø„Åæ„Åó„Åü„ÄÇ
Ë®ÄË™û„ÅØ„ÄÅÊôÆÊÆµ„Åã„Çâ‰ΩøÁî®„Åó„Å¶„ÅÑ„Çã Node.js „Å®ÂãâÂº∑‰∏≠„ÅÆ Go „ÅÆ 2 Á®ÆÈ°û‰Ωø„ÅÑ„Åæ„Åó„Åü„ÄÇ

AWS „ÅÆ„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´
[„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´: WebSocket API„ÄÅLambda„ÄÅDynamoDB „Çí‰ΩøÁî®„Åó„Åü„Çµ„Éº„Éê„Éº„É¨„Çπ„ÉÅ„É£„ÉÉ„Éà„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆÊßãÁØâ](https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/websocket-api-chat-app.html)

## „Å§„Åè„Å£„Åü„ÇÇ„ÅÆ

„É™„Éù„Ç∏„Éà„É™
[aws-tutorial-chat-app](https://github.com/momonoki1990/aws-tutorial-chat-app)

ÂÖÉ„ÄÖ„ÅÆ„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´„ÅÆ„Éï„Ç°„Ç§„É´(Cloudformation)
[tutorial-ver](https://github.com/momonoki1990/aws-tutorial-chat-app/tree/main/tutorial-ver)

Node.js x Serverless Framework
[node-ver](https://github.com/momonoki1990/aws-tutorial-chat-app/tree/main/node-ver)

Go x Serverless Framework
[go-ver](https://github.com/momonoki1990/aws-tutorial-chat-app/tree/main/go-ver)

## WebSocket „Å®„ÅØ

> WebSocket „Éó„É≠„Éà„Ç≥„É´„ÅØ‰ªïÊßò RFC 6455 „ÅßË™¨Êòé„Åï„Çå„Å¶„Åä„Çä„ÄÅ„Åì„Çå„ÅØÊ∞∏Á∂öÁöÑ„Å™Êé•Á∂ö„Çí‰ªã„Åó„Å¶„Éñ„É©„Ç¶„Ç∂„Å®„Çµ„Éº„ÉêÈñì„Åß„Éá„Éº„Çø„Çí‰∫§Êèõ„Åô„ÇãÊñπÊ≥ï„ÇíÊèê‰æõ„Åó„Åæ„Åô„ÄÇÊé•Á∂ö„ÅÆÂàáÊñ≠„ÇÑËøΩÂä†„ÅÆ HTTP „É™„ÇØ„Ç®„Çπ„Éà„Çí„Åô„Çã„Åì„Å®„Å™„Åè„ÄÅ„Éá„Éº„Çø„Çí ‚Äú„Éë„Ç±„ÉÉ„Éà‚Äù „Å®„Åó„Å¶ÂèåÊñπÂêë„Å´Ê∏°„Åô„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ
> WebSocket „ÅØÁ∂ôÁ∂öÁöÑ„Å´„Éá„Éº„Çø‰∫§Êèõ„ÇíÂøÖË¶Å„Å®„Åô„Çã„Çà„ÅÜ„Å™„Çµ„Éº„Éì„Çπ„Å´Áâπ„Å´ÈÅ©„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ‰æã„Åà„Å∞„ÄÅ„Ç™„É≥„É©„Ç§„É≥„Ç≤„Éº„É†„ÇÑ„É™„Ç¢„É´„Çø„Ç§„É†„ÅÆÂèñÂºï„Ç∑„Çπ„ÉÜ„É†„Å™„Å©„Åß„Åô„ÄÇ
> https://ja.javascript.info/websocket

„ÉÅ„É£„ÉÉ„Éà„Åß„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆ„ÇÑ„Çä„Å®„Çä„ÅÆ„Çà„ÅÜ„Å´„ÄÅ„É™„Ç¢„É´„Çø„Ç§„É†„ÅßÊé•Á∂öËÄÖ„Å´ÂØæ„Åó„Å¶„Éá„Éº„Çø„ÅÆÂ§âÊõ¥„ÇíÂèçÊò†„Åï„Åõ„Åü„ÅÑ„Å®„ÅÑ„Å£„ÅüÂ†¥Âêà„Å´‰ΩøÁî®„Åï„Çå„Åæ„Åô„ÄÇ

`ws://`„Å®`wss://`„Éó„É≠„Éà„Ç≥„É´„Åå„ÅÇ„Å£„Å¶„ÄÅ`wss`(WebSocket over TLS)„Åß„ÅØ HTTPS „Å®Âêå„Åò„Çà„ÅÜ„Å´„Éá„Éº„Çø„ÅåÊöóÂè∑Âåñ„Åï„Çå„Çã„Çà„ÅÜ„Åß„Åô„ÄÇ

## „Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£

![](/images/websocket-chatapp/architecture.png)

([„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´](https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/websocket-api-chat-app.html)„Çà„ÇäËª¢Ëºâ)

‰ªäÂõû„ÅØ„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´„ÅÆÊßãÊàê„Åù„ÅÆ„Åæ„Åæ„Åß„Åô„Åå„ÄÅÊé•Á∂ö„ÉªÂàáÊñ≠„ÅÆ„Çø„Ç§„Éü„É≥„Ç∞„ÅßÊé•Á∂ö ID(`connectionID`)„Çí DynamoDB „Å´ÂèçÊò†„Åï„Åõ„Å¶„ÄÅ`sendMessage`„Ç§„Éô„É≥„Éà„ÅåÁô∫Áîü„Åó„ÅüÈöõ„Å´„ÄÅÂèó‰ø°„Åó„Åü„É°„ÉÉ„Çª„Éº„Ç∏„Çí„Çµ„Éº„Éê„Éº„Åã„ÇâÂêÑÊé•Á∂öËÄÖ„Å´ÈÄÅ‰ø°„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

Chrome „ÅÆ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Çø„Éñ„ÅßÁ¢∫Ë™ç„Åó„Åü„Å®„Åì„Çç„ÄÅÊúÄÂàù„ÅÆÊé•Á∂öÁ¢∫Ë™ç„ÇíË°å„Å™„Å£„Å¶„ÅÑ„Çã GET „É™„ÇØ„Ç®„Çπ„Éà„Å†„ÅëÁ¢∫Ë™ç„Åß„Åç„Åæ„Åó„Åü„ÄÇ

(`101 Switching Protocols`„ÅåËøî„Å£„Å¶„Åç„Å¶„ÅÑ„Çã)
![](/images/websocket-chatapp/101_Switching_Protocols.png)

‚Äª[Go Ë®ÄË™û„Å´„Çà„Çã Web „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÈñãÁô∫](https://www.amazon.co.jp/Go%E8%A8%80%E8%AA%9E%E3%81%AB%E3%82%88%E3%82%8BWeb%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E9%96%8B%E7%99%BA-Mat-Ryer/dp/4873117526)„Åß‰ΩúÊàê„Åó„Åü[„ÉÅ„É£„ÉÉ„Éà„Ç¢„Éó„É™](https://github.com/momonoki1990/go-web-app-orreilly-book/tree/main/chat-app)„ÇíÂãï„Åã„Åó„Å¶Á¢∫Ë™ç„Åó„Åæ„Åó„Åü„ÄÇ

## APIGateway „Åß„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥„Ç∞

[API Gateway „Åß„ÅÆ WebSocket API „Å´„Å§„ÅÑ„Å¶](https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/apigateway-websocket-api-overview.html)
[WebSocket API „ÅÆ„É´„Éº„Éà„ÅÆÊìç‰Ωú](https://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/websocket-api-develop-routes.html#apigateway-websocket-api-route-selection-expressions)

Êó¢ÂÆö„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥„Ç∞„Åå 3 „Å§„ÅÇ„Å£„Å¶„ÄÅ„Åù„Çå„Åû„ÇåÊé•Á∂öÊôÇ(`$connect`)„ÉªÂàáÊñ≠ÊôÇ(`$disconnect`)„Éª„Å©„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥„Ç∞„Å´„ÇÇÂΩì„Å¶„ÅØ„Åæ„Çâ„Å™„ÅÑÊôÇ(`$default`)„Å´‰ΩøÁî®„Åï„Çå„Åæ„Åô„ÄÇ

„Åù„Çå‰ª•Â§ñ„ÅÆÁã¨Ëá™„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥„Ç∞„ÅØ„ÄÅ„É™„ÇØ„Ç®„Çπ„Éà„Éú„Éá„Ç£„Å´Âê´„Åæ„Çå„ÇãÁâπÂÆö„ÅÆ key(„É´„Éº„ÉàÈÅ∏ÊäûÂºè)„ÅÆÂÄ§„ÇíÂÖÉ„Å´Ë°å„ÅÑ„Åæ„Åô„ÄÇ

ÂÖ¨Âºè„Éâ„Ç≠„É•„É°„É≥„Éà„Å†„Å®„ÄÅ`request.body.action`„Åå„É´„Éº„ÉàÈÅ∏ÊäûÂºè(REST „ÅßË®Ä„ÅÜ„Å®„Åì„Çç„ÅÆ„É´„Éº„ÉÜ„Ç£„É≥„Ç∞„ÅÆ path „Å†„Å®ÊÄù„ÅÑ„Åæ„Åô)„Å´ÊåáÂÆö„Åï„Çå„Å¶„ÅÑ„Å¶„ÄÅ‰ªäÂõû„ÅÆ„Ç¢„Éó„É™„Åß„ÇÇÂêåÊßò„Å´„ÄÅ`{"action": "sendmessage", "message: "hello"}`„Å®„ÅÑ„ÅÜ„É™„ÇØ„Ç®„Çπ„Éà„Éú„Éá„Ç£„ÇíÂèó„ÅëÂèñ„Å£„Åü„Çâ„ÄÅ‰ªñ„ÅÆÊé•Á∂öËÄÖ„Å´ÂØæ„Åó„Å¶„É°„ÉÉ„Çª„Éº„Ç∏(`hello`)„ÅåËª¢ÈÄÅ„Åï„Çå„Çã„Çà„ÅÜ„Å´„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ

Ë§áÊï∞„ÅÆÂÄ§„ÅßÂà§Êñ≠„Åó„Åü„ÇäÂ§âÊï∞„ÇíÂê´„ÇÅ„Çã„Åì„Å®„ÇÇ„Åß„Åç„Çã„Çà„ÅÜ„Åß„Åô„ÄÇ

![](/images/websocket-chatapp/route_expression.png)

## Serverless Framework

[Serverless Framework: Websocket](https://www.serverless.com/framework/docs/providers/aws/events/websocket)

Lambda Èñ¢Êï∞Âèä„Å≥ AWS „ÅÆÈñ¢ÈÄ£„É™„ÇΩ„Éº„Çπ„Çí„Çµ„ÇØ„ÉÉ„Å®‰Ωú„Çå„Çã„Éï„É¨„Éº„É†„ÉØ„Éº„ÇØ„Åß„Åô„ÄÇ

Lambda „ÇíËµ∑ÁÇπ„Å®„Åó„Åü„Çµ„Éº„Éê„Éº„É¨„Çπ„Å™ÊßãÊàê„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Çí‰Ωú„ÇãÈöõ„Å´„Çà„Åè‰ΩøÁî®„Åï„Çå„ÇãÂç∞Ë±°„Åß„Åô„ÄÇ

‰Ωø„Å£„Å¶„Åø„Åü„Åì„Å®„ÇÇ„Å™„ÅÑ„ÅÆ„ÅßÂÆüÈöõ„Å´„Å©„ÅÆ„Åè„Çâ„ÅÑ‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Çã„ÅÆ„Åã„Çè„Åã„Çä„Åæ„Åõ„Çì„Åå„ÄÅ„Éâ„Ç≠„É•„É°„É≥„Éà„ÇíË¶ã„Çã„Å®„ÄÅGCP „Å™„Å©„ÅÆ AWS ‰ª•Â§ñ„ÅÆ„ÇØ„É©„Ç¶„Éâ„Å´„ÇÇÂà©Áî®„Åß„Åç„Åæ„Åô„ÄÇ

[Serverless Google Cloud Functions Provider Documentation](https://www.serverless.com/framework/docs/providers/google)

> Serverless Framework „ÅÆÈñãÁô∫Ëá™‰Ωì„ÇÇ AWS Âêë„Åë„Åå„É°„Ç§„É≥„Å´„Å™„Å£„Å¶„ÅÑ„Çã„Åø„Åü„ÅÑ„Å™„ÅÆ„Åß„ÄÅAWS „Å®Âêå„ÅòÊßò„Å™‰æøÂà©„Åï„ÇíÊÉ≥ÂÉè„Åó„Å¶‰Ωø„ÅÜ„Å´„ÅØÁèæÊÆµÈöé„Åß„ÅØÂ∞ë„ÅóÂé≥„Åó„ÅÑ„Åã„Å™„Å®ÊÑü„Åò„Åæ„Åó„Åü„ÄÇ
> [Google Cloud Functions „Çí Serverless Framework „ÅßÁí∞Â¢ÉÊßãÁØâ„Åó„Å¶„Åø„Çã](https://dev.classmethod.jp/articles/google-cloud-functions-with-serverless-framework/)

„Å™„Çã„Åª„Å©„Åß„Åô„Å≠ÔºÅ

## Âãï‰Ωú

![](/images/websocket-chatapp/demo_slg_gif.gif)

AWS „ÅÆ„Éâ„Ç≠„É•„É°„É≥„ÉàÂÜÖ„Åß„ÇÇÁ¥π‰ªã„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅnpm „É©„Ç§„Éñ„É©„É™„ÅÆ`wscat`„Çí„ÇØ„É©„Ç§„Ç¢„É≥„Éà„Å®„Åó„Å¶‰ΩøÁî®„Åó„ÄÅAPI Gateway „Å´Êé•Á∂ö„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

`wscat -c {„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà}`„ÅßÊé•Á∂öÂæå„ÄÅ`{"action": "sendmessage", "message": "hello"}`„ÇíÂÖ•Âäõ„Åó„Å¶ Enter „ÇíÊäº„Åô„Å®„ÄÅ„É°„ÉÉ„Çª„Éº„Ç∏„Åå„Çµ„Éº„Éê„Éº„Å´ÈÄÅ‰ø°„Åï„Çå„ÄÅ`sendmessage`„Éè„É≥„Éâ„É©„Åß„É°„ÉÉ„Çª„Éº„Ç∏„Çí‰ªñ„ÅÆÊé•Á∂öËÄÖ„Å´Ëª¢ÈÄÅ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

[wscat](https://github.com/websockets/wscat)„ÅÆ„ÇΩ„Éº„Çπ„Ç≥„Éº„Éâ„ÇíË¶ã„Å¶„Åø„Çã„Å®„ÄÅnpm „É©„Ç§„Éñ„É©„É™„ÅÆ[ws](https://github.com/websockets/ws)„Çí‰Ωø„Å£„Å¶„ÅÑ„Çã„Çà„ÅÜ„Åß„Åô„Å≠„ÄÇ

## „É™„ÇΩ„Éº„Çπ„ÅÆ‰ΩúÊàê

`serverless.ts`(go „Éê„Éº„Ç∏„Éß„É≥„ÅØ`.yml`)„Å´ DynamoDB „ÇÑ IAM „Å™„Å©„ÅÆ„É™„ÇΩ„Éº„Çπ„ÇíÂÆöÁæ©„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

„Åæ„Åü„ÄÅNode „Éê„Éº„Ç∏„Éß„É≥„Å® Go „Éê„Éº„Ç∏„Éß„É≥„ÅßÂæÆÂ¶ô„Å´ÈÅï„ÅÑ„Åæ„Åô„Åå„ÄÅ`connect/`„Å™„Å©Èñ¢Êï∞Âêç„ÅÆ„Éá„Ç£„É¨„ÇØ„Éà„É™‰ª•‰∏ã„Åß Lambda Èñ¢Êï∞„ÇíÂÆöÁæ©„Åó„ÄÅAPI Gateway „Å®„ÅÆÁ¥ê‰ªò„Åë„ÇíË®òËºâ„Åó„Å¶„ÅÑ„Åæ„Åô(Go „ÅØ`serverless.yml`„Å´)

IAM(DynamoDB „Å∏„ÅÆ„Ç¢„ÇØ„Çª„ÇπË®±ÂèØ)

```ts:serverless.ts
iam: {
      role: {
        statements: [
          {
            Effect: "Allow",
            Action: [
              "dynamodb:Get*",
              "dynamodb:Query",
              "dynamodb:Scan",
              "dynamodb:Delete*",
              "dynamodb:Update*",
              "dynamodb:PutItem",
            ],
            Resource: [{ "Fn::GetAtt": ["connectionsTable", "Arn"] }],
          },
        ],
      },
    },
```

DynamoDB

```ts:serverless.ts
resources: {
    Resources: {
      // Table for recording connectionId
      connectionsTable: {
        Type: "AWS::DynamoDB::Table",
        Properties: {
          TableName: "${self:custom.DB_TABLE_NAME}",
          KeySchema: [
            {
              AttributeName: "connectionId",
              KeyType: "HASH",
            },
          ],
          AttributeDefinitions: [
            { AttributeName: "connectionId", AttributeType: "S" },
          ],
          // NOTE: for on demand capacity, not provisioned
          BillingMode: "PAY_PER_REQUEST",
        },
        UpdateReplacePolicy: "Delete",
        DeletionPolicy: "Delete",
      },
    },
  },
```

Lambda Èñ¢Êï∞„Å® WebSocket API „ÅÆÁ¥ê‰ªò„Åë

```ts:src/functions/send-message/index.ts
export default {
  handler: `${handlerPath(__dirname)}/handler.main`,
  events: [
    {
      websocket: {
        route: "sendmessage",
      },
    },
  ],
};
```

„Éá„Éó„É≠„Ç§

```
$ npx sls deploy --stage {app stage e.g. production, dev} --region {region e.g. ap-northeast-1} --aws-profile {your aws profile name}
```

stage „ÇÑ region „Å™„Å©„ÅØ`serverless.ts(yml)`ÂÜÖ„ÅßË®≠ÂÆö„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ

[Serverless.yml Reference](https://www.serverless.com/framework/docs/providers/aws/guide/serverless.yml)
[Serverless Framework: Websocket](https://www.serverless.com/framework/docs/providers/aws/events/websocket)

## APIGatewayMagegementAPI

Êé•Á∂öËÄÖ„Å∏„ÅÆ„Éá„Éº„ÇøÈÄÅ‰ø°„ÅØ APIGatewayMagegementAPI „Çí‰Ωø„Å£„Å¶Ë°å„ÅÑ„Åæ„Åô„ÄÇ
DynamoDB „ÅÆ`connections`„ÉÜ„Éº„Éñ„É´„Åã„ÇâÁèæÂú®Êé•Á∂ö„Åï„Çå„Å¶„ÅÑ„Çã„ÇØ„É©„Ç§„Ç¢„É≥„Éà„ÅÆÊé•Á∂öËÄÖ ID „ÇíÂèñÂæó„Åó„ÄÅ„Åù„Çå„Å®„É°„ÉÉ„Çª„Éº„Ç∏„Çí APIGatewayMagegementAPI „Å´Ê∏°„Åó„Å¶„Éá„Éº„Çø„ÇíÈÄÅ‰ø°„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

Node „Éê„Éº„Ç∏„Éß„É≥

```ts:src/functions/send-message/handler.ts
// Send message to all clients
const sendMessages = connections.Items.map(async ({ connectionId }) => {
  // exclude the sender of the message
  if (connectionId === event.requestContext.connectionId) return;
  try {
      await callbackAPI
      .postToConnection({ ConnectionId: connectionId, Data: message })
      .promise();
  } catch (e) {
      console.log(e);
  }
});

try {
  await Promise.all(sendMessages);
} catch (err) {
  return handleError(err);
}
```

Go „Éê„Éº„Ç∏„Éß„É≥

```go:send_message/main.go
// Send message to all clients
var body Body
if err := json.Unmarshal([]byte(req.Body), &body); err != nil {
    return Response{StatusCode: 500}, err
}

managementAPI := apigatewaymanagementapi.New(session, &aws.Config{
    Endpoint: aws.String(req.RequestContext.DomainName + "/" + req.RequestContext.Stage),
})

for _, id := range connectionIDs {
    if id == connectionID {
        continue
    }
    if _, err := managementAPI.PostToConnection(&apigatewaymanagementapi.PostToConnectionInput{ConnectionId: &id, Data: []byte(body.Message)}); err != nil {
        return Response{StatusCode: 500}, err
    }
}
```

aws-cli „Çí‰Ωø„Å£„Å¶„ÄÅ„É≠„Éº„Ç´„É´„Åã„Çâ APIGatewayMagegementAPI ÁµåÁî±„ÅßÊé•Á∂öËÄÖ„Å´„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÄÅ‰ø°„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ

```shell
$ aws apigatewaymanagementapi post-to-connection \
--data $(echo '{ "name": "hello" }' | base64) \
--endpoint-url 'https://324v05mks9.execute-api.ap-northeast-1.amazonaws.com/dev' \
--connection-id 'bZYNAdtjNjMCKCw=' \
--profile {AWS„Éó„É≠„Éï„Ç°„Ç§„É´Âêç}

Âà•„Çø„Éº„Éü„Éä„É´
$ wscat -c wss://324v05mks9.execute-api.ap-northeast-1.amazonaws.com/dev
Connected (press CTRL+C to quit)
< { "name": "hello" }
```

[AWS API Gateway „ÅÆ WebSocket API „Çí„Å°„ÇÉ„Çì„Å®ÁêÜËß£„Åô„Çã](https://zenn.dev/mryhryki/articles/2020-12-01-aws-api-gateway-websocket)
[AWS Lambda Èñ¢Êï∞„ÅÆÂëº„Å≥Âá∫„Åó„Åå AWS CLI v2 „Å´„Ç¢„ÉÉ„Éó„Éá„Éº„Éà„Åô„Çã„Å®Â§±Êïó„Åô„Çã](https://dev.classmethod.jp/articles/aws-cli-v2-blob-default-base64/)

## Node „Éê„Éº„Ç∏„Éß„É≥

```md
3rd party libraries

- [json-schema-to-ts](https://github.com/ThomasAribart/json-schema-to-ts) - uses JSON-Schema definitions used by API Gateway for HTTP request validation to statically generate TypeScript types in your lambda's handler code base
- [middy](https://github.com/middyjs/middy) - middleware engine for Node.Js lambda. This template uses [http-json-body-parser](https://github.com/middyjs/middy/tree/master/packages/http-json-body-parser) to convert API Gateway `event.body` property, originally passed as a stringified JSON, to its corresponding parsed object
```

Ëá™ÂãïÁîüÊàê„Åï„Çå„Åü README „Å´Ë®òËºâ„Åï„Çå„Å¶„ÅÑ„Åæ„Åó„Åü„Åå„ÄÅ„Éá„Éï„Ç©„É´„Éà„Åß„ÅØ`json-schema-to-ts`„Å®`middy`„Å®„ÅÑ„ÅÜ„É©„Ç§„Éñ„É©„É™„Åå„Éê„É™„Éá„Éº„Ç∑„Éß„É≥„ÇÑ„Éü„Éâ„É´„Ç¶„Çß„Ç¢„Å®„Åó„Å¶‰Ωø„Çè„Çå„Å¶„ÅÑ„Å¶„ÄÅ„Éè„É≥„Éâ„É©Èñ¢Êï∞„Åå export „Åô„ÇãÈöõ„Å´„É©„ÉÉ„Éó„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ

```ts:/functions/hello/handler.ts
import { middyfy } from '@libs/lambda';
export const main = middyfy(hello);
```

‰ªäÂõû„ÅØ WebSocket API „Åß„ÅØ„Å©„ÅÜ‰Ωø„ÅÜ„ÅÆ„ÅãË™ø„Åπ„Çã„ÅÆ„ÅåÈù¢ÂÄí„Åß„ÄÅ„Ç®„É©„Éº„ÇÇÂá∫„Å¶„Åó„Åæ„Å£„Åü„ÅÆ„ÅßÂ§ñ„Åó„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü„Åå„ÄÅ‰æøÂà©„Åù„ÅÜ„Å™„ÅÆ„Åß‰Ωø„Å£„Å¶„Åø„Åü„ÅÑ„Åß„Åô„Å≠„ÄÇ

[Serverless Framework „ÅÆ aws-nodejs-typescript „ÅÆ„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíË©≥„Åó„ÅèË¶ã„Çã](https://zenn.dev/merutin/articles/588b5f02f16f5c#%E5%88%A9%E7%94%A8%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6)

## Go „Éê„Éº„Ç∏„Éß„É≥

Serverless Framework „Åß„ÅÆ Go „Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆ‰Ωú„ÇäÊñπ„ÅØÂÖ¨Âºè„ÅÆ„Éñ„É≠„Ç∞Ë®ò‰∫ã„Åå„ÅÇ„Å£„Åü„ÅÆ„Åß„ÄÅ„Åì„Å°„Çâ„ÇíÂèÇËÄÉ„Å´„Åó„Åæ„Åó„Åü„ÄÇ

[Serverless Framework example for Golang and Lambda](https://www.serverless.com/blog/framework-example-golang-lambda-support/)

ÊúÄÂàù„ÄÅË®ò‰∫ã„Åß‰Ωø„Çè„Çå„Å¶„ÅÑ„Çã`aws-go-dep`„Å®„ÅÑ„ÅÜ„ÉÜ„É≥„Éó„É¨„Éº„Éà„Çí‰Ωø„Å£„Åü„Çâ„Éì„É´„Éâ„Ç®„É©„Éº„ÅåÂá∫„Å¶„ÄÅÂú∞Âë≥„Å´„Éè„Éû„Çä„Åæ„Åó„Åü„ÄÇ

> There are a couple Go templates already included with the Framework as of v1.26‚Äîaws-go for a basic service with two functions, and aws-go-dep for the basic service using the dep dependency management tool. Let's try the aws-go-dep template. You will need dep installed.

Ë®ò‰∫ã„Å´„Å°„ÇÉ„Çì„Å®Êõ∏„ÅÑ„Å¶„ÅÇ„Çä„Åæ„Åó„Åü„Åå„ÄÅ„Åì„Å°„Çâ„ÅÆ„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÅØ„ÄÅGo Modules ‰ª•Ââç„ÅÆ„Éá„Éï„Ç°„ÇØ„Éà„Åß„ÅÇ„Å£„Åü`dep`„Å®„ÅÑ„ÅÜ‰æùÂ≠ò„É©„Ç§„Éñ„É©„É™ÁÆ°ÁêÜ„ÉÑ„Éº„É´„Çí‰ΩøÁî®„Åô„Çã„ÅÆ„ÅåÂâçÊèê„Å†„Å£„Åü„Çà„ÅÜ„Åß„Åô„ÄÇ

[„ÉÜ„É≥„Éó„É¨„Éº„Éà‰∏ÄË¶ß](https://www.serverless.com/framework/docs/providers/aws/cli-reference/create)„Å´Ëºâ„Å£„Å¶„ÅÑ„Åü`aws-go-mod`„Çí‰Ωø„Å£„Åü„Å®„Åì„Çç„ÄÅÁÑ°‰∫ã„Å´„Éì„É´„Éâ„ÅåÈÄö„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ

## ÊÑüÊÉ≥

Node.js „Å® Go x Serverless Framework x Websocket API(API Gateway)„Çí‰Ωø„Å£„Å¶„ÄÅÁ∞°Êòì„Å™„ÉÅ„É£„ÉÉ„Éà„Ç¢„Éó„É™„ÇíÂÜçÁèæ„Åß„Åç„Åæ„Åó„Åü„ÄÇ

Go x Serverless Framework „ÅÆÁµÑ„ÅøÂêà„Çè„Åõ„ÇÇÂàù„ÇÅ„Å¶Ë©¶„Åó„Å¶„Åø„Åæ„Åó„Åü„Åå„ÄÅÂïèÈ°å„Å™„ÅèÈñãÁô∫„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åó„Åü„ÄÇ

ÂÄãÂà•„ÅÆ„ÉÅ„É£„ÉÉ„Éà„É´„Éº„É†„Çí‰Ωú„Å£„Åü„Çä„ÄÅÈÅéÂéª„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫„Åó„Åü„Çä„Å™„Å©„ÄÅÊú¨Ê†ºÁöÑ„Å™„ÉÅ„É£„ÉÉ„Éà„Ç¢„Éó„É™„Çí‰Ωú„Å£„Å¶„Åø„Åü„Åè„Å™„Çä„Åæ„Åô„Å≠„ÄÇ
